
<%- include("header"); -%>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

<h1><%= stationName %> </h1>

<div class="stationDetails">
    <h2>Address: <%= stationAddress %></h2>

    <p> Total number of journeys starting from the station: <%= departures.length %></p>

    <p> Total number of journeys ending at the station: <%= returns.length %></p>

    
    


    <!-- ************************************** -->
    <!-- **** Station as Departure station **** -->
    <!-- ************************************** -->

    <% if (departures.length > 0) { %>
        <br>
        <h3> <%= stationName %> as Departure Station</h3>
        <!-- Calculationg the average distance  -->
        <% let departureSum = 0 %>
        <% for (let i = 0; i < departures.length; i++) { %>
            <% departureSum = departureSum + departures[i].Distance %>
        <% } %>
        <p>The average distance of a journeys: <%= Math.round(departureSum / departures.length) %> m</p>
        
        <!-- Pushing all return stations to array -->
        <% let returnStations= [] %>
        <% for (let i = 0; i < departures.length; i++) { %>
            <% returnStations.push(departures[i].ReturnStationName +" ") %>
        <% } %>

        <!-- Counting the most frequent station from array -->
        <% const countReturn = {}; %>

        <% returnStations.forEach(element => { %>
        <% if (countReturn[element]) { %>
            <%    countReturn[element] += 1; %>
        <% } else { %>
            <%    countReturn[element] = 1; %>
        <% } %>
        <% }); %>

         <!-- Get top value from array -->
        <% let topReturnStation = Object.keys(countReturn).reduce((a, b) => countReturn[a] > countReturn[b] ? a : b); %>
        
        <p>The most common return stations: <%= topReturnStation %> </p>
    <% } %>


    <!-- *********************************** -->
    <!-- **** Station as Return station **** -->    
    <!-- *********************************** -->


    <% if (returns.length > 0) { %>
        <br>
        <h3> <%= stationName %> as Return Station</h3>
         <!-- Calculationg the average distance  -->
        <% let returnSum = 0 %>
        <% for (let i = 0; i < returns.length; i++) { %>
            <% returnSum = returnSum + returns[i].Distance %>
        <% } %>
        
        <p>The average distance of a journeys: <%= Math.round(returnSum / returns.length) %> m</p>

        <!-- Pushing all departurestations to array -->
        <% let departureStations= [] %>
        <% for (let i = 0; i < returns.length; i++) { %>
            <% departureStations.push(returns[i].DepartureStationName +" ") %>
        <% } %>


        <!-- Counting the most frequent station from array -->
        <% const countDeparture = {}; %>

        <% departureStations.forEach(element => { %>
        <% if (countDeparture[element]) { %>
            <%    countDeparture[element] += 1; %>
        <% } else { %>
            <%    countDeparture[element] = 1; %>
        <% } %>
        <% }); %>

         <!-- Get top value from array -->
        <% let topDepartureStation = Object.keys(countDeparture).reduce((a, b) => countDeparture[a] > countDeparture[b] ? a : b); %>


        <p> The most common departure stations: <%= topDepartureStation %> </p>
        <% } %>

        <div id="googleMap"><p id="lng"><%= lng %></p>
            <p id="lat"><%= lat %></p></div>
 
</div>






<%- include("footer") -%>



<script type="text/javascript">
function myMap() {

var mapProp= {
  center:new google.maps.LatLng(document.getElementById("lat").innerHTML, document.getElementById("lng").innerHTML),
  zoom:18,
};
var map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
new google.maps.Marker({
    position: new google.maps.LatLng(document.getElementById("lat").innerHTML, document.getElementById("lng").innerHTML),
    map
  });
}
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtalyAVHd1A_B13gPCIu-Gj90OF_yfL5A&callback=myMap"></script>

